# MVP UATチェックリスト

## 概要

MVP要件定義書（`docs/requirements.md`）に基づく、UAT（User Acceptance Test）チェックリスト。

**対象**: MVP範囲のみ（V1以降の機能は除外）

**前提条件**:
- ローカル開発環境（docker-compose）で動作確認
- テストユーザー: 少なくとも2名（Owner/Editor/Viewer権限テスト用）
- テストデータ: サンプルCSV（50列・1000行程度）

---

## 1. Dataset取り込み（FR-1）

### 1.1 Local CSV Import

**シナリオ**: ローカルCSVファイルをアップロードしてDatasetを作成

**手順**:
1. Dataset一覧画面にアクセス
2. 「新規作成」→「Local CSV」を選択
3. CSVファイルをドラッグ&ドロップまたはファイル選択
4. プレビューが表示されることを確認
5. 取り込み設定を変更（ヘッダ有無、区切り文字、文字コード）
6. 「取り込み」をクリック
7. Dataset一覧に新しいDatasetが表示されることを確認

**期待結果**:
- ✅ CSVファイルが正常にアップロードされる
- ✅ プレビューでデータ構造が確認できる
- ✅ 取り込み設定が反映される
- ✅ Datasetとして保存され、一覧に表示される

**受け入れ基準**: 50列・100万行のCSVを取り込み、Datasetとして参照可能になる

---

### 1.2 S3 CSV Import

**シナリオ**: S3上のCSVファイルを指定してDatasetを作成

**手順**:
1. Dataset一覧画面にアクセス
2. 「新規作成」→「S3 CSV」を選択
3. S3接続設定を入力（バケット名、プレフィックス、ファイル名）
4. 「取り込み」をクリック
5. Dataset一覧に新しいDatasetが表示されることを確認

**期待結果**:
- ✅ S3上のCSVが正常に取り込まれる
- ✅ 認証情報が安全に管理される（UI上に表示されない）
- ✅ Datasetとして保存され、一覧に表示される

**受け入れ基準**: S3上のCSVを選択して取り込み可能

---

### 1.3 Dataset再取り込み

**シナリオ**: 既存Datasetを再取り込みして更新

**手順**:
1. Dataset詳細画面にアクセス
2. 「再取り込み」ボタンをクリック
3. 再取り込み結果を確認（成功/失敗、行数、列数、更新時刻、実行者）
4. スキーマが変わった場合、警告が表示されることを確認

**期待結果**:
- ✅ 再取り込みが正常に実行される
- ✅ 取り込み結果（行数、列数、更新時刻、実行者）が表示される
- ✅ スキーマ変化が検知され、警告が表示される

**受け入れ基準**: 再取り込み時にスキーマが変わった場合、警告が表示される

---

## 2. Transform（PythonベースETL）（FR-2）

### 2.1 Transform定義

**シナリオ**: Transformを作成・編集する

**手順**:
1. Transform一覧画面にアクセス
2. 「新規作成」をクリック
3. Transform名を入力
4. 入力Datasetを選択（複数可）
5. Pythonコードを編集（Monaco Editor）
6. 規約エントリポイント `transform(inputs, params)` を実装
7. 「保存」をクリック
8. Transform一覧に新しいTransformが表示されることを確認

**期待結果**:
- ✅ Transformが正常に作成される
- ✅ 複数Datasetを入力として選択できる
- ✅ Pythonコードエディタが動作する
- ✅ Transformが保存され、一覧に表示される

**受け入れ基準**: 複数Datasetを入力として受け取り、新しいDatasetを出力できる

---

### 2.2 Transform実行（手動）

**シナリオ**: Transformを手動実行して出力Datasetを生成

**手順**:
1. Transform詳細画面にアクセス
2. 「実行」ボタンをクリック
3. 実行中の状態が表示されることを確認
4. 実行完了後、出力Datasetが生成されることを確認
5. 実行履歴に実行記録が追加されることを確認

**期待結果**:
- ✅ Transformが正常に実行される
- ✅ 出力Datasetが生成される
- ✅ 実行履歴が記録される
- ✅ エラー時は適切なエラーメッセージが表示される

**受け入れ基準**: 手動実行でTransformが正常に実行され、出力Datasetが生成される

---

### 2.3 Transform実行制約

**シナリオ**: Transform実行時の制約が守られることを確認

**手順**:
1. 外部ネットワークアクセスを試みるコードを含むTransformを作成
2. Transformを実行
3. 外部ネットワークアクセスが遮断されることを確認
4. タイムアウト上限（5分）を超えるコードを含むTransformを作成
5. Transformを実行
6. タイムアウトエラーが発生することを確認

**期待結果**:
- ✅ 外部HTTP通信が発生しない
- ✅ タイムアウト上限が守られる
- ✅ ホワイトリストライブラリのみ使用可能

**受け入れ基準**: 外部ネットワークアクセスが発生しない、タイムアウト上限が守られる

---

## 3. Card（PythonベースHTMLカード）（FR-3）

### 3.1 カード定義

**シナリオ**: Cardを作成・編集する

**手順**:
1. Card一覧画面にアクセス
2. 「新規作成」をクリック
3. Card名を入力
4. Datasetを選択
5. Pythonコードを編集（Monaco Editor）
6. 規約エントリポイント `render(dataset, filters, params)` を実装
7. 「保存」をクリック
8. Card一覧に新しいCardが表示されることを確認

**期待結果**:
- ✅ Cardが正常に作成される
- ✅ Datasetを選択できる
- ✅ Pythonコードエディタが動作する
- ✅ Cardが保存され、一覧に表示される

**受け入れ基準**: フィルタ適用済みデータを受け取り、HTMLを生成できる

---

### 3.2 フィルタ適用

**シナリオ**: Cardプレビューでフィルタを適用する

**手順**:
1. Card詳細画面にアクセス
2. 「プレビュー」タブを開く
3. フィルタを設定（カテゴリ、日付）
4. 「プレビュー実行」をクリック
5. フィルタ適用済みデータでHTMLが生成されることを確認

**期待結果**:
- ✅ フィルタが正常に適用される
- ✅ フィルタ適用済みデータでHTMLが生成される
- ✅ プレビューでHTMLが表示される

**受け入れ基準**: ページフィルタ変更でカードが再描画される（フィルタ反映が確認できる）

---

### 3.3 HTMLの安全な表示

**シナリオ**: CardのHTMLが安全に表示されることを確認

**手順**:
1. XSS攻撃を試みるコードを含むCardを作成（例: `<script>alert('XSS')</script>`）
2. Cardをプレビュー
3. スクリプトが実行されないことを確認
4. Plotly等の許可ライブラリを使用するCardを作成
5. Cardをプレビュー
6. Plotlyが正常に動作することを確認

**期待結果**:
- ✅ XSSや任意スクリプト混入が防止される
- ✅ Plotly等の許可ライブラリが動作する
- ✅ iframe分離が適用される

**受け入れ基準**: XSSや任意スクリプト混入が防止される、Plotly等の許可ライブラリが動作する

---

### 3.4 カード実行制約

**シナリオ**: Card実行時の制約が守られることを確認

**手順**:
1. 外部ネットワークアクセスを試みるコードを含むCardを作成
2. Cardをプレビュー
3. 外部ネットワークアクセスが遮断されることを確認
4. タイムアウト上限（10秒）を超えるコードを含むCardを作成
5. Cardをプレビュー
6. タイムアウトエラーが発生することを確認

**期待結果**:
- ✅ 外部HTTP通信が発生しない（実行環境・ブラウザ両面で）
- ✅ タイムアウト上限が守られる
- ✅ 実行ログが記録される

**受け入れ基準**: 外部HTTP通信が発生しない、タイムアウト上限が守られる

---

## 4. Dashboard（作成・配置・閲覧）（FR-4）

### 4.1 Dashboard作成/編集

**シナリオ**: Dashboardを作成・編集する

**手順**:
1. Dashboard一覧画面にアクセス
2. 「新規作成」をクリック
3. Dashboard名を入力
4. 「保存」をクリック
5. Dashboard編集画面でカードを追加（ドラッグ&ドロップ）
6. カードを移動・リサイズ（グリッドレイアウト）
7. 「保存」をクリック
8. Dashboard一覧に新しいDashboardが表示されることを確認

**期待結果**:
- ✅ Dashboardが正常に作成される
- ✅ カードを追加・削除できる
- ✅ カードを移動・リサイズできる（グリッドレイアウト）
- ✅ レイアウトが保存される

**受け入れ基準**: 保存後にレイアウトが保持される

---

### 4.2 Dashboard閲覧モード

**シナリオ**: Dashboardを閲覧する

**手順**:
1. Dashboard一覧画面にアクセス
2. Dashboardを選択して閲覧画面を開く
3. カードのロード状態/エラー状態が視認できることを確認
4. 複数カードが配置されていることを確認

**期待結果**:
- ✅ カードの状態が明確に表示される（ロード中、エラー、成功）
- ✅ 複数カードが配置される

**受け入れ基準**: カードの状態が明確に表示される

---

## 5. ページフィルタ（カテゴリ、日付）（FR-5）

### 5.1 フィルタ種別

**シナリオ**: ページフィルタを操作する

**手順**:
1. Dashboard閲覧画面にアクセス
2. フィルタバーを表示
3. カテゴリフィルタを設定（1選択/複数選択）
4. 日付フィルタを設定（期間、カレンダーUI）
5. フィルタが複数カードに反映されることを確認

**期待結果**:
- ✅ カテゴリフィルタが動作する（1選択/複数選択）
- ✅ 日付フィルタが動作する（期間、カレンダーUI）
- ✅ フィルタが複数カードに反映される

**受け入れ基準**: カテゴリ・日付の変更が、複数カードに反映される

---

### 5.2 フィルタ適用ルール

**シナリオ**: フィルタ適用ルールを確認

**手順**:
1. Dashboard閲覧画面にアクセス
2. ページフィルタを設定
3. フィルタが適用されているカードが識別できることを確認（アイコン等）
4. カード側で宣言されていないフィルタは無視されることを確認

**期待結果**:
- ✅ フィルタが適用されているカードが識別できる
- ✅ カード側で宣言されていないフィルタは無視される

**受け入れ基準**: フィルタが適用されているカードが識別できる

---

### 5.3 フィルタUI

**シナリオ**: フィルタUIの操作性を確認

**手順**:
1. Dashboard閲覧画面にアクセス
2. フィルタバーを表示/非表示できることを確認
3. フィルタ適用中の表示（カード上のアイコン等）を確認

**期待結果**:
- ✅ フィルタバーを表示/非表示できる
- ✅ フィルタ状態が視覚的に分かる

**受け入れ基準**: フィルタ状態が視覚的に分かる

---

## 6. FilterView（フィルタ状態の保存）（FR-6）

### 6.1 FilterView操作

**シナリオ**: フィルタ状態を保存・適用する

**手順**:
1. Dashboard閲覧画面にアクセス
2. ページフィルタを設定
3. 「フィルタビューを保存」をクリック
4. ビュー名を入力
5. 「保存」をクリック
6. 保存済みビュー一覧に新しいビューが表示されることを確認
7. 保存済みビューを選択して適用
8. 複数フィルタが一括復元されることを確認

**期待結果**:
- ✅ フィルタ状態を名前付きビューとして保存できる
- ✅ 保存済みビュー一覧が表示される
- ✅ ビュー適用で複数フィルタが一括復元される
- ✅ ビューを更新・削除できる

**受け入れ基準**: ビュー適用で複数フィルタが一括復元される

---

### 6.2 FilterView共有

**シナリオ**: FilterViewを共有する

**手順**:
1. Dashboard閲覧画面にアクセス
2. FilterViewを作成
3. 「共有」オプションを有効化
4. 共有ビューがDashboard共有メンバーに表示されることを確認
5. デフォルトビューを設定
6. Dashboard閲覧時にデフォルトビューが自動適用されることを確認

**期待結果**:
- ✅ 個人用ビューと共有ビューを区別できる
- ✅ 共有ビューが共有メンバーに表示される
- ✅ デフォルトビューが設定できる

**受け入れ基準**: 共有ビューが共有メンバーに表示される

---

## 7. 共有/権限（Dashboardのみ）（FR-7）

### 7.1 Dashboard共有

**シナリオ**: Dashboardをユーザ/グループに共有する

**手順**:
1. Dashboard編集画面にアクセス（Owner権限）
2. 「共有」ボタンをクリック
3. 共有ダイアログを開く
4. 「このDashboardが参照しているDataset一覧」が表示されることを確認
5. ユーザまたはグループを選択
6. 権限種別を選択（Viewer/Editor/Owner）
7. 「共有」をクリック
8. 共有一覧に新しい共有が表示されることを確認

**期待結果**:
- ✅ Dashboardをユーザまたはグループへ共有できる
- ✅ 権限種別（Viewer/Editor/Owner）を設定できる
- ✅ 共有ダイアログにDataset一覧が表示される
- ✅ 共有一覧が表示される

**受け入れ基準**: Ownerがグループへ共有でき、グループメンバーが閲覧できる

---

### 7.2 権限チェック

**シナリオ**: 権限チェックが正常に動作することを確認

**手順**:
1. Viewer権限でDashboardを閲覧
2. 編集ボタンが表示されないことを確認
3. Editor権限でDashboardを編集
4. 編集が可能であることを確認
5. Viewer権限で編集を試みる（直接URLアクセス）
6. 403エラーが返されることを確認
7. Owner権限で共有管理
8. 共有管理が可能であることを確認

**期待結果**:
- ✅ Dashboard閲覧時に権限チェックが動作する
- ✅ Dashboard編集時にEditor/Owner権限チェックが動作する
- ✅ Dashboard共有時にOwner権限チェックが動作する
- ✅ 権限のない操作が拒否される

**受け入れ基準**: 権限のない操作が拒否される

---

## 8. Chatbot（データ質問）（FR-8）

### 8.1 Chatbot機能

**シナリオ**: DashboardのデータについてAIに質問する

**手順**:
1. Dashboard閲覧画面にアクセス
2. チャットパネルを開く
3. Dashboardが参照するDatasetについて質問を入力（例: 「売上トップ5は？」）
4. 「送信」をクリック
5. AIが適切な回答を返すことを確認

**期待結果**:
- ✅ Dashboard画面にチャットパネルが表示される
- ✅ Dashboardのデータについて自然言語で質問できる
- ✅ 適切な回答が得られる

**受け入れ基準**: Dashboardのデータについて自然言語で質問でき、適切な回答が得られる

---

### 8.2 Datasetサマリ生成

**シナリオ**: 大規模Datasetでもサマリが生成されることを確認

**手順**:
1. 100万行のDatasetを含むDashboardを作成
2. Chatbotで質問を送信
3. Datasetサマリが生成され、質問に回答できることを確認

**期待結果**:
- ✅ 100万行のDatasetでもサマリが生成される
- ✅ サマリに基づいて質問に回答できる

**受け入れ基準**: 100万行のDatasetでもサマリが生成され、質問に回答できる

---

## 9. エンドツーエンドシナリオ

### 9.1 データ分析フロー

**シナリオ**: Dataset取り込み → Transform実行 → Card作成 → Dashboard配置の一連の流れ

**手順**:
1. Local CSVをアップロードしてDatasetを作成
2. Transformを作成して実行、出力Datasetを生成
3. Cardを作成してプレビュー
4. Dashboardを作成してCardを配置
5. ページフィルタを設定
6. FilterViewを保存
7. Dashboardを共有
8. 共有メンバーがDashboardを閲覧

**期待結果**:
- ✅ 一連のフローが正常に動作する
- ✅ 各ステップでエラーが発生しない
- ✅ データが正しく処理される

**受け入れ基準**: エンドツーエンドで正常に動作する

---

## 10. 非機能要件

### 10.1 性能（暫定SLO）

**シナリオ**: 性能SLOを確認

**手順**:
1. Dashboard初回表示の応答時間を測定（p95 5秒以内）
2. フィルタ変更後の再描画時間を測定（p95 2.5秒以内）
3. カード単体実行タイムアウトを確認（10秒）
4. Transform実行タイムアウトを確認（5分）

**期待結果**:
- ✅ Dashboard初回表示: p95 5秒以内
- ✅ フィルタ変更後の再描画: p95 2.5秒以内
- ✅ カード単体実行タイムアウト: 10秒
- ✅ Transform実行タイムアウト: 5分

**受け入れ基準**: SLOが守られる

---

### 10.2 セキュリティ

**シナリオ**: セキュリティ要件を確認

**手順**:
1. Python実行時のネットワーク遮断を確認
2. HTML表示時のXSS防止を確認
3. 監査ログが記録されることを確認

**期待結果**:
- ✅ 外部ネットワークアクセスが発生しない
- ✅ XSSが防止される
- ✅ 監査ログが記録される

**受け入れ基準**: セキュリティ要件が守られる

---

## UAT判定基準

### ✅ UAT合格条件

以下の条件をすべて満たす場合、UAT合格とする：

1. **機能要件**: FR-1〜FR-8のすべてのシナリオが正常に動作する
2. **ブロッカー解消**: 以下のブロッカーがすべて解消されている
   - Card Preview実行統合
   - Transform実行統合
   - FilterView管理UI
   - Dashboard共有管理UI
   - Groupメンバーシップチェック
3. **エンドツーエンド**: データ分析フローが正常に動作する
4. **非機能要件**: 性能SLOとセキュリティ要件が守られる

### ⚠️ UAT不合格条件

以下のいずれかに該当する場合、UAT不合格とする：

1. **ブロッカー未解消**: 上記ブロッカーのいずれかが未解消
2. **重大な不具合**: データ損失、セキュリティ侵害、システムクラッシュが発生
3. **性能要件未達**: 性能SLOが守られない
4. **機能要件未達**: FR-1〜FR-8のいずれかが正常に動作しない

---

## テスト結果記録

### テスト実施日
- 実施日: _______________
- 実施者: _______________

### テスト結果サマリ

| カテゴリ | シナリオ数 | 合格 | 不合格 | 未実施 |
|---------|----------|------|--------|--------|
| Dataset取り込み | 3 | | | |
| Transform | 3 | | | |
| Card | 4 | | | |
| Dashboard | 2 | | | |
| ページフィルタ | 3 | | | |
| FilterView | 2 | | | |
| 共有/権限 | 2 | | | |
| Chatbot | 2 | | | |
| エンドツーエンド | 1 | | | |
| 非機能要件 | 2 | | | |
| **合計** | **24** | | | |

### 詳細結果

各シナリオのテスト結果を記録：

1. Dataset取り込み - Local CSV Import: ✅ / ❌ / ⏸️
2. Dataset取り込み - S3 CSV Import: ✅ / ❌ / ⏸️
3. Dataset取り込み - Dataset再取り込み: ✅ / ❌ / ⏸️
4. Transform - Transform定義: ✅ / ❌ / ⏸️
5. Transform - Transform実行（手動）: ✅ / ❌ / ⏸️
6. Transform - Transform実行制約: ✅ / ❌ / ⏸️
7. Card - カード定義: ✅ / ❌ / ⏸️
8. Card - フィルタ適用: ✅ / ❌ / ⏸️
9. Card - HTMLの安全な表示: ✅ / ❌ / ⏸️
10. Card - カード実行制約: ✅ / ❌ / ⏸️
11. Dashboard - Dashboard作成/編集: ✅ / ❌ / ⏸️
12. Dashboard - Dashboard閲覧モード: ✅ / ❌ / ⏸️
13. ページフィルタ - フィルタ種別: ✅ / ❌ / ⏸️
14. ページフィルタ - フィルタ適用ルール: ✅ / ❌ / ⏸️
15. ページフィルタ - フィルタUI: ✅ / ❌ / ⏸️
16. FilterView - FilterView操作: ✅ / ❌ / ⏸️
17. FilterView - FilterView共有: ✅ / ❌ / ⏸️
18. 共有/権限 - Dashboard共有: ✅ / ❌ / ⏸️
19. 共有/権限 - 権限チェック: ✅ / ❌ / ⏸️
20. Chatbot - Chatbot機能: ✅ / ❌ / ⏸️
21. Chatbot - Datasetサマリ生成: ✅ / ❌ / ⏸️
22. エンドツーエンド - データ分析フロー: ✅ / ❌ / ⏸️
23. 非機能要件 - 性能（暫定SLO）: ✅ / ❌ / ⏸️
24. 非機能要件 - セキュリティ: ✅ / ❌ / ⏸️

### 不具合・課題

| ID | カテゴリ | シナリオ | 不具合内容 | 重要度 | 状態 |
|----|---------|---------|-----------|--------|------|
| | | | | | |

### UAT判定

- [ ] ✅ UAT合格
- [ ] ❌ UAT不合格

**判定理由**:
________________________________________________________
